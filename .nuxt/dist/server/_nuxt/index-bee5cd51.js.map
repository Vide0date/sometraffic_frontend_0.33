{"version":3,"file":"index-bee5cd51.js","sources":["../../../../pages/admin-settings/index.vue"],"sourcesContent":["<template>\n    <div class=\"flex flex-col\">\n        <div class=\"flex mb-4\">\n            <h1 class=\"font-bold\">Admin settings</h1>\n        </div>\n        <hr>\n        <div class=\"flex flex-col mt-4 p-8 gap-y-4\">\n            <label for=\"download\">Backup database</label>\n            <hr class=\"border-gray-300\">\n            <button name=\"download\" class=\"mb-8 text-black cursor-pointer w-fit px-4 py-2 rounded-md bg-gray-400 hover:bg-gray-600 transition\" @click=\"downloadDb()\"\n                >Download Database</button\n              >\n              <label>Account</label>\n              <hr class=\"border-gray-300\">\n                <div class=\"flex\">\n                  <div class=\"basis-2/5  \">\n                    <div id=\"group-selector\" class=\"relative\">\n              <div @click=\"showProjectsList = !showProjectsList\" class=\"rounded-md cursor-pointer relative flex bg-white p-3 w-3/5 text-black\">\n                <button type=\"button\">{{ accounts.length ? accounts.find(group => group.id == activeAccount) ? accounts.find(group => group.id == activeAccount).name : 'select group' : '' }}</button>\n                <span :class=\"{ 'rotate-180': showProjectsList }\" class=\"absolute right-3 top-1/2 -translate-y-1\"><svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" id=\"Capa_1\" x=\"0px\" y=\"0px\" width=\"24px\" height=\"14px\" viewBox=\"0 0 960 560\" enable-background=\"new 0 0 960 560\" xml:space=\"preserve\">\n  <g id=\"Rounded_Rectangle_33_copy_4_1_\">\n  \t<path d=\"M480,344.181L268.869,131.889c-15.756-15.859-41.3-15.859-57.054,0c-15.754,15.857-15.754,41.57,0,57.431l237.632,238.937   c8.395,8.451,19.562,12.254,30.553,11.698c10.993,0.556,22.159-3.247,30.555-11.698l237.631-238.937   c15.756-15.86,15.756-41.571,0-57.431s-41.299-15.859-57.051,0L480,344.181z\"/>\n  </g>\n                </svg></span>\n              </div>\n              <div v-show=\"showProjectsList\" class=\"absolute overflow-y-auto max-h-96 -right-2 top-0  flex flex-col gap-y-4 bg-white rounded-md p-4 text-black\">\n                <div class=\"flex flex-col gap-y-2\" v-for=\"(account, index) in accounts\" :key=\"account.id\">\n                  <button type=\"button\" @click=\"setAccount(account.id)\">{{ account.name }}</button>\n                  <hr :class=\"{ 'border-black': index + 1 === accounts.length }\">\n                </div>\n                <button class=\"text-center cursor-pointer\" @click=\"navigateTo('/accounts/add'); showProjectsList = false;\">+ Add an account</button>\n                <hr>\n                <button class=\"text-center cursor-pointer\" @click=\"navigateTo('/accounts'); showProjectsList = false;\">View accounts list</button>\n              </div>\n            </div>\n            </div>\n                </div>\n\n                <label>Emails</label>\n            <hr class=\"border-gray-300\">\n            <nuxt-link to=\"emails\" class=\"text-black cursor-pointer w-fit px-4 py-2 rounded-md bg-gray-400 hover:bg-gray-600 transition\"\n                >Emails settings</nuxt-link\n              >\n\n        </div>\n\n    </div>\n</template>\n<script setup>\ndefinePageMeta({\n  middleware: [\"admin\"],\n});\n\nimport moment from \"moment-timezone\";\n\nconst config = useRuntimeConfig();\nconst db_name = moment(new Date()).format(\"YYYY-MM-DD-HH_mm\");\nconst full_db_name = `sometraffic-${db_name}`;\nconst AWN = inject(\"$awn\");\nconst accounts = ref([])\nconst activeAccount = ref(localStorage.getItem('activeAccount'))\nconst showProjectsList = ref(false);\n\nconst setAccount = (id) => {\n  showProjectsList.value = false;\n  const activeAccount = accounts.value.find(account => account.id === parseInt(id)) \n  localStorage.removeItem('activeProject')\n  localStorage.setItem('activeAccount', activeAccount.id)\n  localStorage.setItem('activeAccountData', JSON.stringify(activeAccount))\n  const router = useRouter()\n  router.go()\n}\n\nconst setAccounts = async () => {\n  const { data: data } = await useFetch(`${config.API_BASE_URL}accounts/all`)\n  accounts.value = data.value\n}\n\n\n\nconst downloadDb = () => {\n  const link = document.createElement(\"a\");\n  link.href = `${config.API_BASE_URL}files/sometraffic.sql`;\n  link.download = full_db_name;\n  link.target = \"_blank\";\n  link.click();\n};\n\nconst setActiveAccount = (e) => {\n    const id = e.target.value\n    const accountName = e.target.selectedOptions[0].innerText\n    const activeAccount = accounts.value.find(account => account.id === parseInt(id)) \n    localStorage.removeItem('activeProject')\n    localStorage.setItem('activeAccount', activeAccount.id)\n    localStorage.setItem('activeAccountData', JSON.stringify(activeAccount))\n    AWN.success(`Active account changed to ${accountName}`);\n    const router = useRouter()\n    router.go()\n}\nonBeforeMount(setAccounts)\nonMounted(() => {\n  document.addEventListener(\"click\", function(evt) {\n        let groupEl = document.getElementById('group-selector'),\n          targetEl = evt.target; // clicked element      \n        do {\n          if(targetEl == groupEl) {\n            // This is a click inside, does nothing, just return.\n            return;\n          }\n          // Go up the DOM\n          targetEl = targetEl.parentNode;\n        } while (targetEl);\n        // This is a click outside.\n        showProjectsList.value = false\n      });\n}\n  );\n\n</script>"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuDA,qBAAA;AACA,WAAA,IAAA,KAAA,CAAA,EAAA,OAAA,kBAAA;AAEA,WAAA,MAAA;AACA,UAAA,WAAA,IAAA,EAAA;AACA,UAAA,gBAAA,IAAA,aAAA,QAAA,eAAA,CAAA;AACA,UAAA,mBAAA,IAAA,KAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}
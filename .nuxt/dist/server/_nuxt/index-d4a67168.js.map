{"version":3,"file":"index-d4a67168.js","sources":["../../../../pages/admin-settings/index.vue"],"sourcesContent":["<template>\n    <div class=\"flex flex-col\">\n        <div class=\"flex mb-4\">\n            <h1 class=\"font-bold\">Admin settings</h1>\n        </div>\n        <hr>\n        <div class=\"flex flex-col mt-4 p-8 gap-y-4\">\n            <label for=\"download\">Backup database</label>\n            <hr class=\"border-gray-300\">\n            <button name=\"download\" class=\"mb-8 text-black cursor-pointer w-fit px-4 py-2 rounded-md bg-gray-400 hover:bg-gray-600 transition\" @click=\"downloadDb()\"\n                >Download Database</button\n              >\n\n                <label>Emails</label>\n            <hr class=\"border-gray-300\">\n            <nuxt-link to=\"emails\" class=\"text-black cursor-pointer w-fit px-4 py-2 rounded-md bg-gray-400 hover:bg-gray-600 transition\"\n                >Emails settings</nuxt-link\n              >\n\n        </div>\n\n    </div>\n</template>\n<script setup>\ndefinePageMeta({\n  middleware: [\"admin\"],\n});\n\nimport moment from \"moment-timezone\";\n\nconst config = useRuntimeConfig();\nconst db_name = moment(new Date()).format(\"YYYY-MM-DD-HH_mm\");\nconst full_db_name = `sometraffic-${db_name}`;\nconst AWN = inject(\"$awn\");\nconst accounts = ref([])\nconst activeAccount = ref(localStorage.getItem('activeAccount'))\nconst showAccountsList = ref(false);\n\nconst setAccount = (id) => {\n  showAccountsList.value = false;\n  const activeAccount = accounts.value.find(account => account.id === parseInt(id)) \n  localStorage.removeItem('activeProject')\n  localStorage.setItem('activeAccount', activeAccount.id)\n  localStorage.setItem('activeAccountData', JSON.stringify(activeAccount))\n  const router = useRouter()\n  router.go()\n}\n\nconst setAccounts = async () => {\n  const { data: data } = await useFetch(`${config.API_BASE_URL}accounts/all`)\n  accounts.value = data.value\n}\n\n\n\nconst downloadDb = () => {\n  const link = document.createElement(\"a\");\n  link.href = `${config.API_BASE_URL}files/sometraffic.sql`;\n  link.download = full_db_name;\n  link.target = \"_blank\";\n  link.click();\n};\n\nconst setActiveAccount = (e) => {\n    const id = e.target.value\n    const accountName = e.target.selectedOptions[0].innerText\n    const activeAccount = accounts.value.find(account => account.id === parseInt(id)) \n    localStorage.removeItem('activeProject')\n    localStorage.setItem('activeAccount', activeAccount.id)\n    localStorage.setItem('activeAccountData', JSON.stringify(activeAccount))\n    AWN.success(`Active account changed to ${accountName}`);\n    const router = useRouter()\n    router.go()\n}\nonBeforeMount(setAccounts)\nonMounted(() => {\n  document.addEventListener(\"click\", function(evt) {\n        let accountEl = document.getElementById('account-selector'),\n          targetEl = evt.target; // clicked element      \n        do {\n          if(targetEl == accountEl) {\n            // This is a click inside, does nothing, just return.\n            return;\n          }\n          // Go up the DOM\n          targetEl = targetEl.parentNode;\n        } while (targetEl);\n        // This is a click outside.\n        showAccountsList.value = false\n      });\n}\n  );\n\n</script>"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AA8BA,qBAAA;AACA,WAAA,IAAA,KAAA,CAAA,EAAA,OAAA,kBAAA;AAEA,WAAA,MAAA;AACA,QAAA,EAAA;AACA,QAAA,aAAA,QAAA,eAAA,CAAA;AACA,QAAA,KAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}